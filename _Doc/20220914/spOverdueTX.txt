/****** Object:  StoredProcedure [dbo].[spOverdueTX]    Script Date: 9/21/2022 10:29:43 PM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[spOverdueTX] 
 @FromDate date 
 ,@ToDate date
AS
BEGIN
SET NOCOUNT ON;

SELECT Orders.OrderID  , Orders.OrderCode ,Orders.CustomerID ,Orders.OrderDate,Orders.ExpireDate  
,Orders.OrderStatus,Orders.GrandTotal,Orders.Total as PayTotal  
,Menu.TableName,Menu.MenuDisplay
FROM Orders     
left outer join Menu on Orders.TableID=menu.MenuID

WHERE Orders.IsDelete =0 
AND Orders.IsCancel = 0   
and Orders.TableID in(39,41) --invoice
AND Orders.OrderDate Between @FromDate AND @ToDate 
AND Orders.RefReceiptID>0  AND Orders.RefReceiptID not in(select RefOrderID from Cheque where Cheque.IsDelete=0 )  
	 
	 
AND ExpireDate <= @ToDate  AND Orders.IsInActive = 0  AND Orders.IsCancel= 0  
AND Orders.OrderDate <= @ToDate  
union all
SELECT Orders.OrderID  , Orders.OrderCode ,Orders.CustomerID ,Orders.OrderDate,Orders.ExpireDate  
,Orders.OrderStatus,Orders.GrandTotal,Orders.Total as PayTotal
,Menu.TableName,Menu.MenuDisplay
FROM Orders     
left outer join Menu on Orders.TableID=menu.MenuID

WHERE Orders.IsDelete =0 
AND Orders.IsCancel = 0   
and Orders.TableID in(39,41) --invoice
AND Orders.OrderDate Between @FromDate AND @ToDate 
AND Orders.RefBillID>0  AND Orders.RefBillID not in(select RefOrderID from Cheque where Cheque.IsDelete=0 )   
AND ExpireDate <= @ToDate  AND Orders.IsInActive = 0  AND Orders.IsCancel= 0  
AND Orders.OrderDate <= @ToDate  
ORDER BY Orders.OrderCode

END
GO


